# 配置电量计算任务

创建流数据处理任务时，选择 **电量计算模板**，即可配置对设备的发电量和用电量的计算任务。

## 设置计算方法

为电量计算任务配置计算方法：

1. 电量计算类型目前支持 **天级电量** 计算，即计算电量的周期为1天。当下一天的电量数据到达时，输出当天的总电量数据。       
2. 电量计算方式目前支持 **电表读数分段差值累加法**。天级电量等于当天所有分段电量的总和。对电量计算方式和逻辑的详细介绍，请参考 [电量计算逻辑](../../reference/power_calculation_logic)。
3. 选择是否需要输出固定分段时间区间的电量明细数据。

## 配置数据处理策略

在 **数据处理** 一栏中，点击 **新增策略**，在弹出的窗口中定义计算电量的详细参数。每条数据处理策略都包含输入点、输出点、分段斜率阈值限定、倍率、输出电量的时间间隔。

1. 在 **输入点** 下拉菜单中，选择模型和采集电表读数的测点。输入点必须为数值类型的测点（支持 int、float、double）。

2. 在 **分段斜率范围** 下拉菜单中，选择设置斜率范围的方式。通过设定分段斜率的阈值，来处理异常数据。例如，(0, max]表示当分段斜率在0 - max之间时，当前的表读数为正常数据。超出分段斜率范围的异常数据不会被计算。对分段斜率的详细介绍，请参考 [电量计算逻辑](../../reference/power_calculation_logic)。

   分段斜率范围的设置有2种方式：

   - **固定阈值范围**：输入固定的阈值范围。上限值和下限值必须是大于等于0的数值，且下限值要小于上限值。
   - **关联模型属性**：通过模型属性定义的分段斜率范围。下限值默认为0，上限值选择模型的属性项。

3. 在 **倍率** 下拉菜单中，选择计算电量的电能表倍率。倍率的设置有2种方式：

   - **固定大小**：输入固定的电能表倍率值。
   - **关联模型属性**：通过模型属性定义的电能表倍率。

4. 在 **天级电量输出点** 下拉菜单中，选择输出天级电量的测点，测点类型必须是PI类型。

5. 如开启输出电量明细功能，选择相应的输出点和时间间隔：

   - **明细电量输出点**：选择输出固定时间间隔内电量的测点，测点类型必须是PI类型。
   - **明细电量时间间隔**：选择输出分段区间电量的时间间隔。

6. 点击 **确认** 按钮，保存电量数据处理策略。

.. note:: 输入点、输出点、分段斜率关联的模型属性、倍率关联的模型属性都必须属于同一个模型，并且输入点和输出点不能是同一个点。

## 示例

典型的天级电量计算任务的配置，如下图所示：

.. image:: ../../media/pi_stream_sample.png

## 后续操作

[保存及发布流数据处理任务](publishing_job)
