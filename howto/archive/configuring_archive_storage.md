# 配置数据归档任务
EnOS支持对设备采集原始数据和流式计算处理之后的实时数据、以及来自离线通道的数据进行归档，提供灵活的存储配置方式，降低数据存储的成本。
## 新建数据归档任务
对数据行归档存储，需为资产模型创建归档任务。

1. 登录EnOS控制台，在 **通用资源** 下，选择 **数据归档**。
2. 点击 **新建任务**，选择待同步数据的数据源（实时消息通道或离线消息通道），输入任务名称和描述。
3. 点击 **确定**，进入归档任务详细配置页。

.. note:: 单个组织内最多可创建5条数据归档任务。

### 基础信息

编辑数据归档任务的基础信息：

1. **名称**：数据归档任务的名称，支持中文、英文大小写字母、数字、和下划线，并且不能超过50个字符。
2. **描述**：对数据归档任务的描述，不能超过100个字符。

### 存储配置

填写存储归档数据的详细配置信息，包括选择存储资源、设置存储文件属性等。

1. 选择 **资源类型**，指定同步归档文件的目标存储系统（支持HDFS和BLOB）。
2. 从 **存储资源** 下拉菜单中，选择已通过 [外部源连接](/docs/offline-data/zh_CN/2.0.8/data_source/index.html) 注册的数据源，或通过 [资源管理](/docs/enos/zh_CN/2.0.8/resourcemanagement/overview.html) 申请的HDFS存储资源。
3. 输入归档数据在存储系统中的 **存储路径**，路径必须以"/"开始和结尾，并选择存储路径根目录的时间分区格式。对时间分区格式的详细介绍，参见 [存储路径分区参数](../../reference/archive_storage#path)。
4. 选择按事件时间或系统时间生成目录，对按不同时间生成目录的详细介绍，参见 [数据归档逻辑](../../reference/archive_storage#logic)。
5. 输入归档 **文件名称**，支持英文大小写字母、数字、和中横线，并且不能超过50个字符。文件生成时，系统将自动在文件名后加上"\_UTC"时间戳后缀。若选择按事件时间生成目录，则时间戳后缀为数据的事件时间对应的UTC+0时间；若选择按系统时间生成目录，则时间戳后缀为系统时间对应的UTC+0时间；
6. 选择 **文件类型**，目前支持TEXTFILE格式（.csv）。
7. 选择归档文件 **编码格式**，默认格式为UTF-8。
8. 选择 **列分隔符**，默认为逗号。
9. 选择归档文件 **压缩格式**，默认为非压缩。
10. 选择归档文件 **大小上限**（文件压缩前的大小限制）。如果文件超出上限，系统将对文件进行切分存储。切分后的文件命名规则为 `filename_UTC_n`，`n`为6位随机字符串。

.. note:: 数据归档任务一旦提交，文件类型、编码格式、列分隔符、压缩格式不可再修改。

### 归档配置

选择数据归档任务的 **归档周期**，若被归档数据处于同一时间窗口内，将被写入同一个文件，然后按文件大小上限进行切分。目前支持数据归档任务以1小时为周期归档数据。

<!--

选择较长的归档周期，可以有效减少因数据延迟产生的小文件数量。设置不同的归档周期，归档任务的计划开始时间不同，处理的数据区间也不同。每个归档周期，对应的归档数据范围，表示系统时间处于 “前一个归档周期的计划开始时间” 至 “当前归档周期的计划开始时间” 之间的数据。数据归档策略提交之后，归档周期不可再修改。

每个归档周期选项的计划开始时间，以及归档数据的范围，参见 [归档周期说明](../../reference/archive_storage#cycle)。

-->

### 内容配置

选择归档数据所属的模型。单个模型可配置多个数据归档任务。

以上配置完成之后，点击 **确认**，提交数据归档任务配置。数据归档任务提交后，将立即生效。

数据归档以归档任务提交时刻为起点，开始从消息通道中读取新的数据。在归档任务提交时对应的归档周期内，如果无数据被缓存，则不会生成归档文件。

如果修改归档任务配置，若当前周期的数据归档任务未完成，将立即按照新提交的配置运行，已归档的数据不受影响。对于新增模型的数据，也将被立即开始归档。

对于生成归档文件的规则，参见 [归档文件生成规则](../../reference/archive_storage#file)。

<!--end-->
