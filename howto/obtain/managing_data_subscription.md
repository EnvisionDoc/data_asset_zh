# 开发数据订阅任务
数据订阅功能是EnOS为提高应用API调用效率而推出的一种主动推送服务，推送内容包括资产实时上送数据和资产告警数据。基于该推送服务，应用获取资产数据不需再不停轮询API，大大提高API调用效率和降低API使用费用。

## 数据订阅使用流程
.. image:: ../../media/data_subscription_process.png

## 创建订阅任务
通过以下步骤，创建数据订阅任务：

1. 进入EnOS控制台 **数据订阅** 页面，点击 **添加订阅** 按钮进入订阅配置页面。

   .. note:: 单个组织下最多可创建5个订阅任务。

2. 选择需要的订阅的数据类型。选择不同的数据类型，订阅配置会稍有不同。以下是订阅服务支持的订阅数据源：
   - 实时数据：实时数据是指资产上送或者计算产生的带时间戳的测点数据
   - 告警数据：告警是指针对实时数据设置一定的告警规则，根据这些告警规则产生的告警数据

3. 输入或选择系统生成订阅任务的ID。每个订阅任务具有全局唯一标识ID，是获取订阅数据时必须提供的参数之一。订阅ID的格式支持英文大小写、下划线、中横线。

4. 选择**SA账号**。每个订阅任务都必须关联一个 [SA账号](https://www.envisioniot.com/docs/app-development/zh_CN/latest/managing_apps.html)，用以Consumer鉴权及数据鉴权。系统会动态检测SA账号的有效性并及时更新订阅配置。当订阅关联的SA账号被删除，则该订阅失效。

   .. note:: 数据订阅关联的SA账号必须已被授权获取资产的数据，否则订阅任务会认证失败，而不能成功订阅数据。授权SA账号的详细信息，请参考 [管理服务账号](/docs/iam/zh_CN/latest/howto/service_account/managing_service_account.html)。

5. 输入 **订阅描述**。

6. 选择 **订阅客户**。根据SA账号的客户数据权限（通过应用购买关系建立），可选择需要订阅的客户数据。当客户解除了对SA账号的授权，与此SA相关的订阅任务会自动解除对该客户数据的订阅。

7. 对实时数据订阅，可配置如下数据过滤条件：

   - 模型测点过滤条件：选择订阅的模型和测点实时数据
   - 设备标签过滤条件：添加设备标签，订阅指定设备的实时数据

8. 对告警数据订阅，可配置如下数据过滤条件：

   - 模型过滤条件：选择订阅的模型告警数据
   - 设备标签过滤条件：添加设备标签，订阅指定设备的告警数据
   - 资产树标签过滤条件：添加资产树标签，订阅指定资产树的告警数据

.. note:: 当订阅配置的模型或测点被删除，订阅配置页面依旧能看到订阅配置信息，但是会提示相关配置项为未知对象。

## 启动订阅任务

数据订阅任务配置完成后，点击 **启动** 按钮开启数据订阅任务。数据订阅服务会按照订阅任务配置，对数据进行分发，并写入相应的Topic中。

## 删除订阅任务

在订阅列表的 **操作** 一栏中，选择 **删除订阅** 按钮，可删除订阅任务。删除订阅任务前，需暂停任务，并且任务删除之后不可恢复。
