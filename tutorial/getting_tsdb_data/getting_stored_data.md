# Unit 5: Getting Stored Data with EnOS APIs

When storage policies are configured for the data of the smart electric meter, and the stream processing jobs are running, both the raw data uploaded to the Cloud and the data processed by the stream processing engine will be stored in EnOS TSDB. You can now invoke the corresponding API to get the stored data of the electric meter.

## Installing EnOS API SDK for Java

In this tutorial, get the Maven dependency information of the EnOS API SDK for Java from the Maven repository and add it to your development project. Detailed steps are as follows:

1. Open the Maven repository of the SDK at https://mvnrepository.com/artifact/com.envisioniot/enos-api/2.3.6.

2. Open the development environment, include the maven dependency for the SDK in your Java project. See the following example.

   ```java
   <dependency>
       <groupId>com.envisioniot</groupId>
       <artifactId>enos-api</artifactId>
       <version>2.3.6</version>
   </dependency>
   ```

Optionally, you can download the source code of the EnOS API SDK from [GitHub](https://github.com/EnvisionIot/enos-api-sdk-java) and install it in your development environment.

## Programming for getting stored data

After the EnOS API SDK for Java is installed, take the following steps to invoke data service APIs to get the stored data in TSDB:

1. Use the `getAssetsAIRawData` API to get the AI type raw data of the electric meter in a time range.
2. Use the `getAssetsAINormalizedData` API to get the calculated data in a time range.

### Getting raw data

Take the following steps to compile the code for the `getAssetAIRawData` API:

1. Define the EnOS environment IP address. Contact your EnOS project manager for details if needed. See the following example:

   ```java
   String enosApiUrl = "https://xxxx.envisioniot.com/enosapi";
   ```

2. Define the `accessKey` and `secretKey` of your application, which can be generated by registering an application in the **Application Registration** section on EnOS Console.

3. Define the request parameters for the API, including the properties of the electric meter. See the following example:

   ```java
   String orgId = "o1552032369xxxx";
   String modelId = "ElectricAcMeter";
   String assetIds = "AYzoMuRP";
   String measurepoints = "Reading";
   String startTime = "2019-03-21T09:00:00-08:00";
   String endTime = "2019-03-26T09:12:00-08:00";
   int pageSize = 100;
   ```

4. Call the `getAssetsAIRawData` API to get the stored raw data of the *Reading* measuring point. See the following example:

   ```java
   import com.envisioniot.enos.enosapi.api.request.dataservice.GetAssetsAIRawDataRequest;
   import com.envisioniot.enos.enosapi.common.exception.EnOSApiException;
   import com.envisioniot.enos.enosapi.common.response.EnOSPage;
   import com.envisioniot.enos.enosapi.common.response.EnOSResponse;
   import com.envisioniot.enos.enosapi.sdk.client.EnOSDefaultClient;

   import java.util.List;
   import java.util.Map;

   public class demo {
       public static void main(String[] args) {
       String enosApiUrl = "api_service_url";
       String accessKey = "access_key";
       String secretKey = "secret_key";
       int connectTimeout = 5000;
       int readTimeout = 5000;
       String orgId = "organization_id";
       String modelId = "ElectricMeter";
       String assetIds = "AYzoMuRP";
       String measurepoints = "Reading";
       String startTime = "2019-03-21T09:00:00-08:00";
       String endTime = "2019-03-26T09:12:00-08:00";
       int pageSize = 100;

       EnOSDefaultClient client = new EnOSDefaultClient(enosApiUrl, accessKey, secretKey, connectTimeout, readTimeout);
       GetAssetsAIRawDataRequest request = new GetAssetsAIRawDataRequest(orgId, modelId, assetIds, measurepoints, startTime, endTime, pageSize);

       try {
           EnOSResponse<EnOSPage<Map<String, Object>>> response = client.execute(request);
           System.out.println("REQUEST："+request.getUrlParams());

           if (response.getData() != null) {

               System.out.println("DATA：" + response.getData().getData());
           }
           System.out.println("STATUS：" + response.getStatus());
           System.out.println("MSG：" + response.getMsg());
           System.out.println("SUBMSG：" + response.getSubmsg());

           EnOSPage<Map<String, Object>> tmpMap = response.getData();

           if (tmpMap != null) {

               List<Map<String, Object>> re = tmpMap.getData();

               for (Map<String, Object> r : re) {
                   System.out.println("timestamp:" + r.get("timestamp"));
                   break;
               }
           }

       } catch (EnOSApiException e) {
           e.printStackTrace();
       }
     }
   }
   ```

   .. note:: The `enosApiUrl` of the API service vary with the cloud region and instance. For private cloud instances, contact your Envision project manager or support representative to get the URL. The `accessKey` and `secretKey` are generated by registering your application on EnOS Console.

5. Invoke the API and check the result. The stored data of the *Reading* measuring point will be returned with time stamp. See the following example:

   ```java
   DATA: [
     {assetId=AYzoMuRP, Reading=0.99552613, timestamp=1553234234380},
     {assetId=AYzoMuRP, Reading=0.68855274, timestamp=1553234234540},
     {assetId=AYzoMuRP, Reading=0.51011103, timestamp=1553234244631},
     {assetId=AYzoMuRP, Reading=0.18516362, timestamp=1553234254727},
     {assetId=AYzoMuRP, Reading=0.80360246, timestamp=1553234264825},
     {assetId=AYzoMuRP, Reading=0.12011969, timestamp=1553234274934},
     ]
   STATUS：0
   MSG：success
   SUBMSG：null
   ```




### Getting calculation result

The data of the *Reading* measuring point processed by the streaming engine is assigned to the *MaxReading10Min* and *MinReading10Min* measuring points, which is stored as AI Normalized Data type.

1. Compile code to call the `getAssetAINormalizedData` API to get the stored data. See the following example:

   ```java
   import com.envisioniot.enos.enosapi.api.request.dataservice.GetAssetsAINormalizedDataRequest;
   import com.envisioniot.enos.enosapi.common.exception.EnOSApiException;
   import com.envisioniot.enos.enosapi.common.response.EnOSPage;
   import com.envisioniot.enos.enosapi.common.response.EnOSResponse;
   import com.envisioniot.enos.enosapi.sdk.client.EnOSDefaultClient;

   import java.util.List;
   import java.util.Map;

   public class demo3 {
       public static void main(String[] args) {
           String enosApiUrl = "api_service_url";
           String accessKey = "access_key";
           String secretKey = "secret_key";
           int connectTimeout = 5000;
           int readTimeout = 5000;
           String orgId = "o1552032369xxxx";
           String modelId = "ElectricMeter";
           String assetIds = "AYzoMuRP";
           String measurepointsWithLogic = "MaxReading10Min, MinReading10Min, ReadingDifference";
           int interval = 0;
           String startTime = "2019-03-21T09:00:00-08:00";
           String endTime = "2019-03-26T09:12:00-08:00";
           int pageSize = 100;

           EnOSDefaultClient client = new EnOSDefaultClient(enosApiUrl, accessKey, secretKey, connectTimeout, readTimeout);
           GetAssetsAINormalizedDataRequest request = new GetAssetsAINormalizedDataRequest(orgId, modelId, assetIds, measurepointsWithLogic, interval, startTime, endTime, pageSize);

           try {
               EnOSResponse<EnOSPage<Map<String, Object>>> response = client.execute(request);
               System.out.println("REQUEST："+request.getUrlParams());

               if (response.getData() != null) {

                   System.out.println("DATA：" + response.getData().getData());
               }
               System.out.println("STATUS：" + response.getStatus());
               System.out.println("MSG：" + response.getMsg());
               System.out.println("SUBMSG：" + response.getSubmsg());

               EnOSPage<Map<String, Object>> tmpMap = response.getData();

               if (tmpMap != null) {

                   List<Map<String, Object>> re = tmpMap.getData();

                   for (Map<String, Object> r : re) {
                       System.out.println("timestamp:" + r.get("timestamp"));
                       break;
                   }
               }

           } catch (EnOSApiException e) {
               e.printStackTrace();
           }
       }
   }
   ```



2. Invoke the API and check the result. The stored data of the *MaxReading10Min*, *MinReading10Min*, and *ReadingDifference* measuring points will be returned with time stamp. See the following example:

   ```java
   DATA：[
     {assetId=AYzoMuRP, MinReading10Min=0.060317636, timestamp=1553234400000},  
     {assetId=AYzoMuRP, MinReading10Min=0.00997293, timestamp=1553235000000},
     {assetId=AYzoMuRP, MinReading10Min=0.0032151341, timestamp=1553235600000},
     {assetId=AYzoMuRP, MinReading10Min=0.022154748, timestamp=1553236200000},
     {assetId=AYzoMuRP, MinReading10Min=0.0015020967, timestamp=1553236800000},

     {assetId=AYzoMuRP, MaxReading10Min=0.97941846, timestamp=1553234400000},
     {assetId=AYzoMuRP, MaxReading10Min=0.9878034, timestamp=1553235000000},
     {assetId=AYzoMuRP, MaxReading10Min=0.9939039, timestamp=1553235600000},
     {assetId=AYzoMuRP, MaxReading10Min=0.9860072, timestamp=1553236200000},
     {assetId=AYzoMuRP, MaxReading10Min=0.99802256, timestamp=1553236800000},

     {assetId=AYzoMuRP, ReadingDifference=0.919100824, timestamp=1553234400000},
     {assetId=AYzoMuRP, ReadingDifference=0.97783047, timestamp=1553235000000},
     {assetId=AYzoMuRP, ReadingDifference=0.9906887659, timestamp=1553235600000},
     {assetId=AYzoMuRP, ReadingDifference=0.963852452, timestamp=1553236200000},
     {assetId=AYzoMuRP, ReadingDifference=0.9965204633, timestamp=1553236800000},
     ]
   STATUS：0
   MSG：success
   SUBMSG：null
   ```



## API reference

The reference documentation for each API can be found through **EnOS API** > **API Documents** in the EnOS Console. Summary of APIs is displayed in tables by API service categories. Click the **More** icon for each API to view details, including API function, calling method, requesting URL, parameter description, calling sample, and response sample.

.. image:: media/api_doc.png

For more information about how to use EnOS API, see [Getting Started with EnOS APIs](/docs/api/en/latest/gettingstarted.html).

<!--end-->
